windows-x64:
    image: ~/vm/windows-server.qcow2
    arch: amd64
    cpus: 2
    memory: 8G
    user: Administrator
    pass: DevWin2022
    uefi: true
    steps:
        - name: TEST 0 Copy to current directory
          copy:
            from: ./lib/src/doctest.h
            to: vm:./

        - name: TEST 1 Test relative path
          copy:
            from: ./lib/src/doctest.h
            to: vm:C:/Users/Administrator/test.h

        - name: TEST 2 Create directory structure
          run: |
            if not exist C:\Users\Administrator\lib mkdir C:\Users\Administrator\lib
            if not exist C:\Users\Administrator\lib\src mkdir C:\Users\Administrator\lib\src

        - name: TEST 3 Copy to pre-created directory
          copy:
            from: ./lib/src/doctest.h
            to: vm:C:/Users/Administrator/lib/src/doctest.h

        - name: Copy Files
          copy:
            from: ./
            to: vm:C:\Users\Administrator
            exclude:
              - .git
              - .github
              - docs

        - name: Run Subsequent Steps Offline
          offline: true

        - name: Configure CMake
          run: cmake -S . -B build -DCMAKE_BUILD_TYPE=Debug -DSYNC_LIB_DOCTEST_ADD_CTESTS=OFF

        - name: Build CMake
          run: cmake --build build

        - name: Run CTest
          run: ctest --test-dir build --output-on-failure