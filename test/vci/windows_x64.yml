windows-x64:
    image: ~/vm/windows-server.qcow2
    arch: amd64
    cpus: 2
    memory: 8G
    user: Administrator
    pass: DevWin2022
    uefi: true
    steps:
        - name: Copy Files
          copy:
            from: ./
            to: vm:C:\Users\Administrator
            exclude:
              - .git
              - .github
              - docs

        - name: Run Subsequent Steps Offline
          offline: true

        - name: Configure CMake Visual Studio
          run: cmake -S . -B build-vs -G "Visual Studio 17 2022" -DCMAKE_BUILD_TYPE=Debug -DSYNC_LIB_DOCTEST_ADD_CTESTS=OFF -DCMAKE_CXX_FLAGS="/utf-8" -DCMAKE_C_FLAGS="/utf-8"

        - name: Build CMake Visual Studio
          run: cmake --build build-vs

        - name: Run CTest Visual Studio
          run: ctest --test-dir build-vs --output-on-failure -C Debug

        - name: Configure CMake MinGW
          run: cmake -S . -B build-mingw -G "MinGW Makefiles" -DCMAKE_BUILD_TYPE=Debug -DSYNC_LIB_DOCTEST_ADD_CTESTS=OFF -DCMAKE_CXX_FLAGS="/utf-8" -DCMAKE_C_FLAGS="/utf-8"

        - name: Build CMake MinGW
          run: cmake --build build-mingw

        - name: Run CTest MinGW
          run: ctest --test-dir build-mingw --output-on-failure -C Debug